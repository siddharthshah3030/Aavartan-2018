var scene,camera,fieldOfView,aspectRatio,nearPlane,farPlane,renderer,container,HEIGHT,WIDTH,ambientLight,hemisphereLight,shadowLight,Colors={red:15881030,white:14209233,pink:16095342,brown:5845806,brownDark:2300175,blue:6865856};function createScene(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,scene=new THREE.Scene,aspectRatio=WIDTH/HEIGHT,fieldOfView=60,nearPlane=1,farPlane=1e4,camera=new THREE.PerspectiveCamera(fieldOfView,aspectRatio,nearPlane,farPlane),scene.fog=new THREE.Fog(16243114,100,950),camera.position.x=0,camera.position.z=200,camera.position.y=100,(renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0})).setSize(WIDTH,HEIGHT),renderer.shadowMap.enabled=!0,(container=document.getElementById("world")).appendChild(renderer.domElement),window.addEventListener("resize",handleWindowResize,!1)}function handleWindowResize(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,renderer.setSize(WIDTH,HEIGHT),camera.aspect=WIDTH/HEIGHT,camera.updateProjectionMatrix()}function createLights(){hemisphereLight=new THREE.HemisphereLight(11184810,0,.9),ambientLight=new THREE.AmbientLight(14452852,.5),(shadowLight=new THREE.DirectionalLight(16777215,.9)).position.set(150,350,350),shadowLight.castShadow=!0,shadowLight.shadow.camera.left=-400,shadowLight.shadow.camera.right=400,shadowLight.shadow.camera.top=400,shadowLight.shadow.camera.bottom=-400,shadowLight.shadow.camera.near=1,shadowLight.shadow.camera.far=1e3,shadowLight.shadow.mapSize.width=2048,shadowLight.shadow.mapSize.height=2048,scene.add(hemisphereLight),scene.add(shadowLight),scene.add(ambientLight)}var Pilot=function(){this.mesh=new THREE.Object3D,this.mesh.name="pilot",this.angleHairs=0;var e=new THREE.BoxGeometry(15,15,15),a=new THREE.MeshPhongMaterial({color:Colors.brown,shading:THREE.FlatShading}),o=new THREE.Mesh(e,a);o.position.set(2,-12,0),this.mesh.add(o);var t=new THREE.BoxGeometry(10,10,10),i=new THREE.MeshLambertMaterial({color:Colors.pink}),s=new THREE.Mesh(t,i);this.mesh.add(s);var n=new THREE.BoxGeometry(4,4,4),r=new THREE.MeshLambertMaterial({color:Colors.brown}),h=new THREE.Mesh(n,r);h.geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,2,0));var d=new THREE.Object3D;this.hairsTop=new THREE.Object3D;for(var E=0;E<12;E++){var l=h.clone(),c=E%3,m=Math.floor(E/3);l.position.set(4*m-4,0,4*c-4),this.hairsTop.add(l)}d.add(this.hairsTop);var w=new THREE.BoxGeometry(12,4,2);w.applyMatrix((new THREE.Matrix4).makeTranslation(-6,0,0));var p=new THREE.Mesh(w,r),H=p.clone();p.position.set(8,-2,6),H.position.set(8,-2,-6),d.add(p),d.add(H);var T=new THREE.BoxGeometry(2,8,10),v=new THREE.Mesh(T,r);v.position.set(-1,-4,0),d.add(v),d.position.set(-5,5,0),this.mesh.add(d);var M=new THREE.BoxGeometry(5,5,5),R=new THREE.MeshLambertMaterial({color:Colors.brown}),g=new THREE.Mesh(M,R);g.position.set(6,0,3);var y=g.clone();y.position.z=-g.position.z;var u=new THREE.BoxGeometry(11,1,11),S=new THREE.Mesh(u,R);this.mesh.add(g),this.mesh.add(y),this.mesh.add(S);var x=new THREE.BoxGeometry(2,3,2),P=new THREE.Mesh(x,i);P.position.set(0,0,-6);var f=P.clone();f.position.set(0,0,6),this.mesh.add(P),this.mesh.add(f)};Pilot.prototype.updateHairs=function(){for(var e=this.hairsTop.children,a=e.length,o=0;o<a;o++){e[o].scale.y=.75+.25*Math.cos(this.angleHairs+o/3)}this.angleHairs+=.16};var sea,airplane,AirPlane=function(){this.mesh=new THREE.Object3D,this.mesh.name="airPlane";var e=new THREE.BoxGeometry(80,50,50,1,1,1),a=new THREE.MeshPhongMaterial({color:Colors.red,shading:THREE.FlatShading});e.vertices[4].y-=10,e.vertices[4].z+=20,e.vertices[5].y-=10,e.vertices[5].z-=20,e.vertices[6].y+=30,e.vertices[6].z+=20,e.vertices[7].y+=30,e.vertices[7].z-=20;var o=new THREE.Mesh(e,a);o.castShadow=!0,o.receiveShadow=!0,this.mesh.add(o);var t=new THREE.BoxGeometry(20,50,50,1,1,1),i=new THREE.MeshPhongMaterial({color:Colors.white,shading:THREE.FlatShading}),s=new THREE.Mesh(t,i);s.position.x=50,s.castShadow=!0,s.receiveShadow=!0,this.mesh.add(s);var n=new THREE.BoxGeometry(15,20,5,1,1,1),r=new THREE.MeshPhongMaterial({color:Colors.red,shading:THREE.FlatShading}),h=new THREE.Mesh(n,r);h.position.set(-40,20,0),h.castShadow=!0,h.receiveShadow=!0,this.mesh.add(h);var d=new THREE.BoxGeometry(30,5,120,1,1,1),E=new THREE.MeshPhongMaterial({color:Colors.red,shading:THREE.FlatShading}),l=new THREE.Mesh(d,E);l.position.set(0,15,0),l.castShadow=!0,l.receiveShadow=!0,this.mesh.add(l);var c=new THREE.BoxGeometry(3,15,20,1,1,1),m=new THREE.MeshPhongMaterial({color:Colors.white,transparent:!0,opacity:.3,shading:THREE.FlatShading}),w=new THREE.Mesh(c,m);w.position.set(5,27,0),w.castShadow=!0,w.receiveShadow=!0,this.mesh.add(w);var p=new THREE.BoxGeometry(20,10,10,1,1,1);p.vertices[4].y-=5,p.vertices[4].z+=5,p.vertices[5].y-=5,p.vertices[5].z-=5,p.vertices[6].y+=5,p.vertices[6].z+=5,p.vertices[7].y+=5,p.vertices[7].z-=5;var H=new THREE.MeshPhongMaterial({color:Colors.brown,shading:THREE.FlatShading});this.propeller=new THREE.Mesh(p,H),this.propeller.castShadow=!0,this.propeller.receiveShadow=!0;var T=new THREE.BoxGeometry(1,80,10,1,1,1),v=new THREE.MeshPhongMaterial({color:Colors.brownDark,shading:THREE.FlatShading}),M=new THREE.Mesh(T,v);M.position.set(8,0,0),M.castShadow=!0,M.receiveShadow=!0;var R=M.clone();R.rotation.x=Math.PI/2,R.castShadow=!0,R.receiveShadow=!0,this.propeller.add(M),this.propeller.add(R),this.propeller.position.set(60,0,0),this.mesh.add(this.propeller);var g=new THREE.BoxGeometry(30,15,10,1,1,1),y=new THREE.MeshPhongMaterial({color:Colors.red,shading:THREE.FlatShading}),u=new THREE.Mesh(g,y);u.position.set(25,-20,25),this.mesh.add(u);var S=new THREE.BoxGeometry(24,24,4),x=new THREE.MeshPhongMaterial({color:Colors.brownDark,shading:THREE.FlatShading}),P=new THREE.Mesh(S,x);P.position.set(25,-28,25);var f=new THREE.BoxGeometry(10,10,6),z=new THREE.MeshPhongMaterial({color:Colors.brown,shading:THREE.FlatShading}),G=new THREE.Mesh(f,z);P.add(G),this.mesh.add(P);var L=u.clone();L.position.z=-u.position.z,this.mesh.add(L);var C=P.clone();C.position.z=-P.position.z,this.mesh.add(C);var b=P.clone();b.scale.set(.5,.5,.5),b.position.set(-35,-5,0),this.mesh.add(b);var I=new THREE.BoxGeometry(4,20,4);I.applyMatrix((new THREE.Matrix4).makeTranslation(0,10,0));var B=new THREE.MeshPhongMaterial({color:Colors.red,shading:THREE.FlatShading}),D=new THREE.Mesh(I,B);D.position.set(-35,-5,0),D.rotation.z=-.3,this.mesh.add(D),this.pilot=new Pilot,this.pilot.mesh.position.set(-10,27,0),this.mesh.add(this.pilot.mesh),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0};function createPlane(){(airplane=new AirPlane).mesh.scale.set(.25,.25,.25),airplane.mesh.position.y=100,scene.add(airplane.mesh)}function createSea(){(sea=new Sea).mesh.position.y=-600,scene.add(sea.mesh)}function createSky(){sky=new Sky,sky.mesh.position.y=-600,scene.add(sky.mesh)}function loop(){updatePlane(),airplane.pilot.updateHairs(),updateCameraFov(),sea.moveWaves(),sky.mesh.rotation.z+=.01,renderer.render(scene,camera),requestAnimationFrame(loop)}function updatePlane(){var e=normalize(mousePos.y,-.75,.75,25,175);normalize(mousePos.x,-.75,.75,-100,100);airplane.mesh.position.y+=.1*(e-airplane.mesh.position.y),airplane.mesh.rotation.z=.0128*(e-airplane.mesh.position.y),airplane.mesh.rotation.x=.0064*(airplane.mesh.position.y-e),airplane.propeller.rotation.x+=.3}function updateCameraFov(){camera.fov=normalize(mousePos.x,-1,1,40,80),camera.updateProjectionMatrix()}function normalize(e,a,o,t,i){return t+(Math.max(Math.min(e,o),a)-a)/(o-a)*(i-t)}function init(e){document.addEventListener("mousemove",handleMouseMove,!1),createScene(),createLights(),createPlane(),createSea(),createSky(),loop()}Sky=function(){this.mesh=new THREE.Object3D,this.nClouds=20,this.clouds=[];for(var e=2*Math.PI/this.nClouds,a=0;a<this.nClouds;a++){var o=new Cloud;this.clouds.push(o);var t=e*a,i=750+200*Math.random();o.mesh.position.y=Math.sin(t)*i,o.mesh.position.x=Math.cos(t)*i,o.mesh.position.z=-400-400*Math.random(),o.mesh.rotation.z=t+Math.PI/2;var s=1+2*Math.random();o.mesh.scale.set(s,s,s),this.mesh.add(o.mesh)}},Sea=function(){var e=new THREE.CylinderGeometry(600,600,800,40,10);e.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),e.mergeVertices();var a=e.vertices.length;this.waves=[];for(var o=0;o<a;o++){var t=e.vertices[o];this.waves.push({y:t.y,x:t.x,z:t.z,ang:Math.random()*Math.PI*2,amp:5+15*Math.random(),speed:.016+.032*Math.random()})}var i=new THREE.MeshPhongMaterial({color:Colors.blue,transparent:!0,opacity:.8,shading:THREE.FlatShading});this.mesh=new THREE.Mesh(e,i),this.mesh.receiveShadow=!0},Sea.prototype.moveWaves=function(){for(var e=this.mesh.geometry.vertices,a=e.length,o=0;o<a;o++){var t=e[o],i=this.waves[o];t.x=i.x+Math.cos(i.ang)*i.amp,t.y=i.y+Math.sin(i.ang)*i.amp,i.ang+=i.speed}this.mesh.geometry.verticesNeedUpdate=!0,sea.mesh.rotation.z+=.005},Cloud=function(){this.mesh=new THREE.Object3D,this.mesh.name="cloud";for(var e=new THREE.CubeGeometry(20,20,20),a=new THREE.MeshPhongMaterial({color:Colors.white}),o=3+Math.floor(3*Math.random()),t=0;t<o;t++){var i=new THREE.Mesh(e.clone(),a);i.position.x=15*t,i.position.y=10*Math.random(),i.position.z=10*Math.random(),i.rotation.z=Math.random()*Math.PI*2,i.rotation.y=Math.random()*Math.PI*2;var s=.1+.9*Math.random();i.scale.set(s,s,s),i.castShadow=!0,i.receiveShadow=!0,this.mesh.add(i)}};var mousePos={x:0,y:0};function handleMouseMove(e){var a=e.clientX/WIDTH*2-1,o=1-e.clientY/HEIGHT*2;mousePos={x:a,y:o}}window.addEventListener("load",init,!1);